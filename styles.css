:root { --size:48px; --accent:#2563eb; --manual-color:#1d4ed8; --hint-green:#16a34a; }
*{box-sizing:border-box} html,body{margin:0;background:#fafafa;color:#111;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,sans-serif}
h1{font-size:20px;margin:16px 16px 8px}.hint{color:#555;margin:0 16px 16px}
.version{font-size:12px;color:#6b7280;font-weight:600;margin-left:6px}
.wrap{display:grid;gap:16px;padding:0 16px 24px;justify-content:start}
.gridwrap{overflow-x:auto;max-width:100%}

/* レイアウト（盤面/行合計/ブロック合計/列合計） */
.gridwrap{display:grid;grid-template-columns:repeat(9,var(--size)) var(--size) 160px;
  grid-template-rows:repeat(9,var(--size)) 48px;column-gap:10px;row-gap:10px;align-items:start;width:max-content}
.board{display:grid;grid-template-columns:repeat(9,var(--size));grid-auto-rows:var(--size);
  border:3px solid #000;background:#fff;width:calc(var(--size)*9);height:calc(var(--size)*9);box-shadow:0 6px 24px rgba(0,0,0,.08);
  grid-column:1/10;grid-row:1/10}
.cell{position:relative;border:1px solid #d1d5db;background:#fff}
.coord{position:absolute;top:2px;left:2px;z-index:3;
  font:600 9px/1 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:#9ca3af;pointer-events:none}
.cell.r0,.cell.r3,.cell.r6{border-top-width:3px}.cell.c0,.cell.c3,.cell.c6{border-left-width:3px}
.cell.r8{border-bottom-width:3px}.cell.c8{border-right-width:3px}
.cell input{width:100%;height:100%;text-align:center;font-size:20px;border:none;outline:none;background:transparent;color:#111;position:relative;z-index:2}
.cell input:focus{box-shadow:inset 0 0 0 2px var(--accent);background:#f0f7ff}

/* 文字色ルール */
.cell.given input{font-weight:700;color:#111}
.cell.ocr input{font-weight:700;color:#111}
.cell.manual input{font-weight:700;color:var(--manual-color)}
.cell.auto input{font-weight:700;color:#e11d48}
.cell.lowconf{box-shadow:inset 0 0 0 2px #f59e0b;background:#fffbeb}
.cell.hinted input{font-weight:700;color:var(--hint-green)}

/* ヒント＝緑の数字オーバーレイ */
.hint-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  font:700 20px/1 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:var(--hint-color);pointer-events:none}

/* Candidate overlay (shown on hint only) */
.cand{position:absolute;inset:2px;display:none;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);z-index:1;
  font:500 10px/1 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:#6b7280;pointer-events:none}
.board.show-cand .cand{display:grid}
.cand span{display:flex;align-items:center;justify-content:center}
.cand span.elim{color:#ef4444;text-decoration:line-through}
.cell.hint-target{box-shadow:inset 0 0 0 2px #16a34a;background:#f0fdf4}
.cell.hint-focus{box-shadow:inset 0 0 0 2px #0ea5e9;background:#eff6ff}
.cell.hint-elim{box-shadow:inset 0 0 0 2px #f59e0b;background:#fff7ed}

/* 検算UI */
.row-sums{grid-column:10/11;grid-row:1/10;display:grid;grid-template-rows:repeat(9,var(--size))}
.right-panel{grid-column:11/12;grid-row:1/10;display:grid;grid-auto-rows:min-content;row-gap:10px;align-content:start}
.block-sums{display:grid;grid-template-columns:repeat(3,1fr);grid-auto-rows:22px;gap:6px;justify-items:center;align-items:center}
.block-sums .label{grid-column:1/4;font-size:12px;color:#444}
.block-sums .bcell{width:34px;height:34px;display:flex;align-items:center;justify-content:center;
  font:700 12px ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;border:1px dashed #cbd5e1;background:#fff}
.col-sums{grid-column:1/12;grid-row:10/11;display:grid;grid-template-columns:repeat(9,var(--size))}
.sumcell{display:flex;align-items:center;justify-content:center;font:700 14px ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;border:1px dashed #cbd5e1;background:#fff}
.sumcell.ok{color:#0b7a33}.sumcell.warn{color:#b45309}.sumcell.err{color:#b91c1c}
.row-sums .sumcell{border-left:3px solid #000}.col-sums .sumcell{border-top:3px solid #000}
.bcell.ok{color:#0b7a33}.bcell.warn{color:#b45309}.bcell.err{color:#b91c1c}

/* 操作UI */
.controls{display:grid;gap:10px}.controls .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
button,.io input[type="text"],select,label.selectwrap{padding:10px 14px;border-radius:10px;border:1px solid #cfd7e3;background:#fff;font-weight:600}
button{min-height:44px}
button{cursor:pointer}button.primary{background:var(--accent);border-color:var(--accent);color:#fff}
.io input[type="text"]{width:360px;max-width:80vw;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
.selectwrap{display:flex;align-items:center;gap:8px}.msg{min-height:1.2em;font-weight:700}
.msg.ok{color:#0b7a33}.msg.warn{color:#b45309}.msg.err{color:#b91c1c}
.note{padding:0 16px 16px}
.history{margin-top:8px;font-size:12px;color:#444}
.history summary{cursor:pointer;font-weight:600}
.history ul{margin:6px 0 0 18px;padding:0}
.history li{margin:4px 0}
@media (max-width:720px){
  :root{--size:42px}
  .wrap{padding:0 12px 20px}
  .controls .row{flex-direction:column;align-items:stretch}
  .controls .row button,.controls .row select,.controls .row label.selectwrap{width:100%}
  .io input[type="text"]{width:100%}
}
@media (max-width:520px){
  :root{--size:36px}
}
